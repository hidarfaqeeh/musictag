# تقرير مفصل عن وظائف وأزرار بوت تعديل الوسوم الصوتية

## 1. الوظائف الرئيسية

### 1.1 استقبال الملفات الصوتية
- **الوصف**: يستقبل البوت الملفات الصوتية (audio) والتسجيلات الصوتية (voice) والملفات (document) التي تحتوي على صوتيات.
- **الدالة المسؤولة**: `receive_audio` في ملف bot.py
- **الاستخدام**: إرسال ملف صوتي مباشرة للبوت
- **العمليات**: 
  * تنزيل الملف الصوتي 
  * تخزينه مؤقتًا 
  * قراءة الوسوم الحالية 
  * عرض الوسوم مع أزرار التحرير

### 1.2 عرض الوسوم الحالية
- **الوصف**: يعرض البوت الوسوم الموجودة في الملف الصوتي مع صورة الغلاف إن وجدت.
- **الدالة المسؤولة**: `display_current_tags` في ملف bot.py
- **المخرجات**: رسالة تعرض جميع الوسوم الحالية مع أزرار للتحرير وحفظ التغييرات وإدارة القوالب.
- **الميزات**: 
  * عرض صورة الغلاف بدقة عالية 
  * علامات خاصة (🔄) للوسوم المعدلة
  * عرض كلمات الأغنية إن وجدت

### 1.3 تحرير الوسوم
- **الوصف**: يسمح للمستخدم بتحرير أي من الوسوم المدعومة.
- **الدالة المسؤولة**: `handle_edit_tags` و `receive_specific_tag_value` في ملف bot.py
- **الوسوم المدعومة**: العنوان، الفنان، الألبوم، فنان الألبوم، السنة، النوع، الملحن، التعليق، رقم المسار، كلمات الأغنية، صورة الغلاف
- **العمليات**: 
  * عرض قائمة بالوسوم القابلة للتعديل 
  * استقبال قيمة جديدة لكل وسم 
  * تحديث العرض فوريًا بعد كل تعديل

### 1.4 إضافة/تغيير صورة الغلاف
- **الوصف**: يسمح للمستخدم بإضافة أو تغيير صورة الغلاف للملف الصوتي.
- **الدالة المسؤولة**: `receive_photo_for_tag` في ملف bot.py
- **الاستخدام**: إرسال صورة بعد اختيار "صورة الغلاف" من قائمة التحرير
- **العمليات**: 
  * تنزيل الصورة بأعلى دقة متاحة 
  * تخزينها مؤقتًا 
  * عرض معاينة للصورة الجديدة

### 1.5 حفظ التغييرات
- **الوصف**: يحفظ جميع التعديلات في الملف الصوتي ويرسل النسخة المعدلة.
- **الدالة المسؤولة**: `save_tags` في ملف bot.py، `save_audio_tags` في ملف tag_handler.py
- **الاستخدام**: الضغط على زر "💾 حفظ التغييرات"
- **العمليات**: 
  * إنشاء نسخة من الملف الأصلي 
  * حفظ الوسوم المعدلة في النسخة الجديدة 
  * إرسال الملف المعدل للمستخدم 
  * تنظيف الملفات المؤقتة

## 2. وظائف إدارة القوالب

### 2.1 حفظ قالب جديد
- **الوصف**: يحفظ الوسوم الحالية كقالب يمكن استخدامه لاحقًا.
- **الدالة المسؤولة**: `handle_save_template` و `receive_template_name` في ملف bot.py، `save_template` في ملف template_handler.py
- **الاستخدام**: الضغط على زر "💾 حفظ كقالب"
- **العمليات**: 
  * طلب اسم للقالب 
  * استخراج اسم الفنان من الوسوم 
  * حفظ القالب مع صورة الغلاف (إن وجدت)

### 2.2 عرض القوالب
- **الوصف**: يعرض قائمة بالفنانين الذين لديهم قوالب محفوظة، ثم يعرض قوالب كل فنان.
- **الدالة المسؤولة**: `handle_show_templates` و `handle_show_artist_templates` في ملف bot.py، `get_artists_with_templates` و `get_templates_for_artist` في ملف template_handler.py
- **الاستخدام**: الضغط على زر "📋 عرض القوالب"
- **العمليات**: 
  * عرض قائمة الفنانين 
  * عرض قوالب الفنان المختار 
  * توفير خيارات تطبيق أو حذف أو تعديل القالب

### 2.3 تطبيق قالب
- **الوصف**: يطبق قالبًا محفوظًا على الملف الصوتي الحالي.
- **الدالة المسؤولة**: `handle_apply_template` في ملف bot.py، `apply_template_to_tags` في ملف template_handler.py
- **الاستخدام**: اختيار قالب من قائمة القوالب المتاحة
- **العمليات**: 
  * تحميل القالب المختار 
  * دمج الوسوم من القالب مع الحفاظ على الوسوم غير المحددة في القالب 
  * تحديث عرض الوسوم المعدلة

### 2.4 حذف قالب
- **الوصف**: يحذف قالبًا محفوظًا بعد تأكيد المستخدم.
- **الدالة المسؤولة**: `handle_delete_template` في ملف bot.py، `delete_template` في ملف template_handler.py
- **الاستخدام**: الضغط على زر "🗑️ حذف" بجانب اسم القالب
- **العمليات**: 
  * طلب تأكيد الحذف 
  * حذف ملف القالب 
  * تحديث قائمة القوالب

### 2.5 إنشاء قالب يدوي
- **الوصف**: يسمح بإنشاء قالب جديد بإدخال الوسوم يدويًا دون الحاجة لملف صوتي.
- **الدالة المسؤولة**: `handle_create_manual_template` و `receive_manual_template` و `receive_manual_template_name` في ملف bot.py
- **الاستخدام**: الضغط على زر "✏️ إنشاء قالب يدوي"
- **العمليات**: 
  * طلب إدخال الوسوم بتنسيق محدد 
  * طلب اسم القالب 
  * حفظ القالب الجديد

## 3. وظائف لوحة الإدارة

### 3.1 فتح لوحة الإدارة
- **الوصف**: يعرض لوحة التحكم الخاصة بالمشرفين.
- **الدالة المسؤولة**: `admin_command` في ملف bot.py، `open_admin_panel` في ملف admin_handlers.py
- **الاستخدام**: إرسال الأمر /admin
- **شروط الاستخدام**: المستخدم يجب أن يكون مشرفًا أو مطورًا
- **العمليات**: 
  * التحقق من صلاحيات المستخدم 
  * عرض أزرار لوحة الإدارة

### 3.2 عرض إحصائيات البوت
- **الوصف**: يعرض إحصائيات استخدام البوت ومعلومات النظام.
- **الدالة المسؤولة**: `get_stats_message` في ملف admin_handlers.py، `get_system_info` في ملف admin_panel.py
- **الاستخدام**: الضغط على زر "📊 الإحصائيات" في لوحة الإدارة
- **المعلومات المعروضة**: 
  * عدد الملفات المعالجة 
  * عدد المستخدمين النشطين 
  * استهلاك الذاكرة 
  * وقت تشغيل البوت

### 3.3 إدارة المستخدمين
- **الوصف**: يسمح بإدارة المشرفين والمستخدمين المحظورين.
- **الدالة المسؤولة**: معالجات متعددة في ملف admin_handlers.py، وظائف متعددة في ملف admin_panel.py
- **الاستخدام**: الضغط على زر "👥 المستخدمين" في لوحة الإدارة
- **العمليات**: 
  * إضافة/إزالة مشرفين 
  * حظر/إلغاء حظر مستخدمين 
  * عرض قائمة المستخدمين النشطين

### 3.4 البث الجماعي
- **الوصف**: يرسل رسالة إلى جميع مستخدمي البوت.
- **الدالة المسؤولة**: `broadcast_command` و `receive_broadcast_message` في ملف bot.py، `send_broadcast` في ملف admin_panel.py
- **الاستخدام**: الضغط على زر "📢 بث جماعي" في لوحة الإدارة
- **العمليات**: 
  * إدخال نص الرسالة 
  * تأكيد الإرسال 
  * إرسال الرسالة لجميع المستخدمين مع تقرير النتائج

### 3.5 إدارة الإعدادات
- **الوصف**: يسمح بتعديل إعدادات البوت المختلفة.
- **الدالة المسؤولة**: معالجات متعددة في ملف admin_handlers.py، `update_setting` في ملف admin_panel.py
- **الاستخدام**: الضغط على زر "⚙️ الإعدادات" في لوحة الإدارة
- **الإعدادات المتاحة**: 
  * تغيير رسالة الترحيب 
  * ضبط حدود الاستخدام 
  * تعيين وقت التأخير بين العمليات 
  * إدارة قنوات الاشتراك الإجباري

### 3.6 المعالجة التلقائية
- **الوصف**: إدارة ميزة المعالجة التلقائية للملفات الصوتية في القنوات.
- **الدالة المسؤولة**: معالجات متعددة في ملف admin_handlers.py، وظائف متعددة في ملف auto_processor.py
- **الاستخدام**: الضغط على زر "🔄 المعالجة التلقائية" في لوحة الإدارة
- **العمليات**: 
  * تفعيل/تعطيل المعالجة التلقائية 
  * تعيين قناة المصدر 
  * إدارة الاستبدالات النصية 
  * إدارة القوالب الذكية

## 4. الأزرار والواجهة

### 4.1 أزرار صفحة عرض الوسوم
- **✏️ تحرير الوسوم**: فتح قائمة تحرير الوسوم
- **💾 حفظ التغييرات**: حفظ التعديلات وإرسال الملف المعدل
- **📋 إدارة القوالب**: فتح قائمة إدارة القوالب
- **💾 حفظ كقالب**: حفظ الوسوم الحالية كقالب جديد
- **❌ إلغاء**: إلغاء العملية وحذف الملفات المؤقتة

### 4.2 أزرار قائمة تحرير الوسوم
- **العنوان، الفنان، الألبوم، إلخ**: أزرار لكل وسم قابل للتعديل
- **🖼️ إضافة/تغيير صورة الغلاف**: لتحميل صورة غلاف جديدة
- **🔙 رجوع**: العودة إلى عرض الوسوم

### 4.3 أزرار قائمة إدارة القوالب
- **💾 حفظ كقالب**: حفظ الوسوم الحالية كقالب
- **📋 عرض القوالب**: عرض القوالب المحفوظة
- **✏️ إنشاء قالب يدوي**: إنشاء قالب جديد يدويًا
- **🔙 رجوع**: العودة إلى عرض الوسوم

### 4.4 أزرار لوحة الإدارة الرئيسية
- **📊 الإحصائيات**: عرض إحصائيات البوت
- **👥 المستخدمين**: إدارة المستخدمين
- **📢 بث جماعي**: إرسال رسالة لجميع المستخدمين
- **⚙️ الإعدادات**: ضبط إعدادات البوت
- **🔄 المعالجة التلقائية**: إدارة المعالجة التلقائية
- **📝 السجلات**: عرض سجلات العمليات
- **🧰 أدوات**: أدوات الصيانة والنسخ الاحتياطي

### 4.5 أزرار صفحة المعالجة التلقائية
- **⚡ تفعيل/تعطيل المعالجة**: تبديل حالة تفعيل المعالجة التلقائية
- **📺 تعيين قناة المصدر**: تحديد القناة التي سيراقبها البوت
- **🔄 الاستبدالات النصية**: إدارة استبدالات النصوص
- **🧠 القوالب الذكية**: ربط قوالب بفنانين معينين
- **⚙️ إعدادات متقدمة**: إعدادات متقدمة للمعالجة التلقائية
- **🔙 رجوع**: العودة إلى لوحة الإدارة الرئيسية

## 5. سير العمل والاستجابة

### 5.1 استجابة الأوامر
- **/start**: ترحيب وشرح وظائف البوت
- **/help**: عرض معلومات مساعدة مفصلة
- **/admin**: فتح لوحة الإدارة (للمشرفين فقط)
- **/templates**: فتح قائمة إدارة القوالب

### 5.2 استجابة الملفات
- **ملف صوتي**: عرض الوسوم الحالية مع أزرار التحرير
- **صورة** (في حالة طلب صورة غلاف): تطبيق الصورة كغلاف للألبوم

### 5.3 استجابة النصوص
- **اسم القالب**: حفظ القالب بالاسم المدخل
- **قيمة الوسم**: تحديث الوسم بالقيمة المدخلة
- **بيانات القالب اليدوي**: تحليل ومعالجة البيانات المدخلة

## 6. الميزات المميزة

### 6.1 حفظ الوسوم الأصلية
- **الوصف**: عند تطبيق قالب، يحافظ البوت على الوسوم غير المذكورة في القالب.
- **المنطق البرمجي**: يدمج القالب مع الوسوم الحالية بدلاً من استبدالها بالكامل.

### 6.2 المعالجة التلقائية
- **الوصف**: مراقبة قناة محددة وتعديل الملفات الصوتية تلقائيًا.
- **آلية العمل**: حذف الملف الأصلي وإرسال ملف معدل جديد.

### 6.3 القوالب الذكية
- **الوصف**: تطبيق قوالب تلقائيًا حسب اسم الفنان في المعالجة التلقائية.
- **الهدف**: توحيد وسوم ملفات نفس الفنان تلقائيًا.

### 6.4 تحسين واجهة المستخدم
- **تحديث الرسائل**: تعديل الرسائل الحالية بدلاً من إرسال رسائل جديدة.
- **علامات التعديل**: إظهار علامة (🔄) بجانب الوسوم المعدلة.
- **أزرار العودة**: وجود زر "رجوع" في كل قائمة فرعية.

### 6.5 نظام التسجيل الشامل
- **الوصف**: تسجيل تفصيلي لجميع العمليات والأخطاء.
- **التنظيم**: سجلات منفصلة لكل نوع من العمليات (مستخدمين، مشرفين، أخطاء، معالجة تلقائية).

## 7. التطوير والتوسع المستقبلي

### 7.1 إمكانيات التوسع
- دعم المزيد من تنسيقات الملفات الصوتية
- إضافة تأثيرات صوتية أساسية (معادلة الصوت، تسريع/إبطاء)
- دعم معالجة دفعات من الملفات

### 7.2 تحسينات مقترحة
- تحسين واجهة مستخدم الويب
- إضافة إشعارات تيليجرام للأحداث المهمة
- تحسين نظام النسخ الاحتياطي التلقائي

### 7.3 متطلبات الصيانة
- تنظيف دوري للملفات المؤقتة
- مراقبة استهلاك الموارد
- تحديث مكتبات الأمان